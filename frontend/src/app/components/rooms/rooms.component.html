<!-- Title -->
<app-title
  [title]="'Rooms Management'"
  [actionTitle]="'Add Room'"
  [onTap]="addRoom"
/>

<!-- Room Form (for create/edit) -->
@if (selectedRoom() !== null) {
<div tuiCardMedium tuiAppearance="neutral" class="mb-4">
  <form (ngSubmit)="saveRoom(selectedRoom()!)">
    <input
      tuiInput
      [(ngModel)]="selectedRoom()!.room_number"
      placeholder="Room Number"
      required
    />
    <input
      tuiInput
      [(ngModel)]="selectedRoom()!.capacity"
      placeholder="Capacity"
      required
    />
    <input
      tuiInput
      [(ngModel)]="selectedRoom()!.name"
      placeholder="Title"
      required
    />
    <button tuiButton type="submit">Save</button>
    <button tuiButton type="button" (click)="cancel()">Cancel</button>
  </form>
</div>
}

<!-- Rooms List -->
<div tuiCardMedium tuiAppearance="neutral" class="mb-4">
  <div tuiHeader>
    <h1 tuiTitle>
      {{ roomsData()?.pagination?.total || 0 }}
      <span tuiSubtitle>Rooms</span>
    </h1>
  </div>
</div>

<!-- Pagination Controls -->
<div class="flex items-center justify-between mb-4">
  <div>
    <span class="tui-text_body-m">Items per page:</span>
    <select
      tuiSelect
      [ngModel]="pageSize"
      (ngModelChange)="onLimitChange($event)"
    >
      @for (option of pageSizeOptions; track option) {
      <option [value]="option">{{ option }}</option>
      }
    </select>
  </div>
  <div>
    <span class="tui-text_body-m">
      Page {{ currentPage + 1 }} of {{ roomsData()?.pagination?.totalPages || 1
      }}
    </span>
  </div>
</div>

@if (isLoading()) {
<tui-loader [showLoader]="true"></tui-loader>
} @else if (roomsData()?.status == 'error') {
<p class="tui-text_h1">Opss!</p>
<p class="tui-text_body-xl">{{ roomsData()?.message }}</p>
} @else {
<table tuiTable [size]="'m'" class="w-full">
  <thead>
    <tr>
      <th tuiTh>Room Number</th>
      <th tuiTh>Capacity</th>
      <th tuiTh>Title</th>
      <th tuiTh>Updated At</th>
      <th tuiTh>Created At</th>
      <th tuiTh>Actions</th>
    </tr>
  </thead>

  <tbody tuiTbody>
    @for (room of (roomsData()?.data || []); track $index) {
    <tr>
      <td tuiTd>
        <span tuiTitle>{{ room.room_number }}</span>
      </td>
      <td tuiTd>
        <span tuiTitle>{{ room.capacity }}</span>
      </td>
      <td tuiTd>
        <span tuiTitle>{{ room.name }}</span>
      </td>
      <td tuiTd>
        <span tuiTitle>{{ room.updated_at }}</span>
      </td>
      <td tuiTd>
        <span tuiTitle>{{ room.created_at }}</span>
      </td>
      <td tuiTd>
        <span tuiStatus>
          <button
            appearance="action"
            iconStart="@tui.pencil"
            size="xs"
            tuiIconButton
            type="button"
            (click)="editRoom(room)"
          >
            Edit
          </button>
          <button
            appearance="action"
            iconStart="@tui.trash"
            size="xs"
            tuiIconButton
            type="button"
            (click)="deleteRoom(room.id!)"
          >
            Delete
          </button>
        </span>
      </td>
    </tr>
    }
  </tbody>
  <tfoot>
    <tr class="bg-white pt-4">
      <td colspan="6">
        @if (roomsData()?.pagination?.totalPages) {
        <tui-pagination
          [length]="roomsData()!.pagination!.totalPages"
          [(index)]="currentPage"
          (indexChange)="onPageChange($event)"
        ></tui-pagination>
        }
      </td>
    </tr>
  </tfoot>
</table>
}
